## 渲染进程

浏览器将 HTML、CSS 和 JS 渲染成页面的整个过程：构建 DOM 树、样式计算、布局阶段、分层、绘制、分块、光栅化和合成。

HTML 的内容由标记和文本组成，称为标签。
CSS 又称层叠样式，是由选择器和属性组成。
JS 主要作用是让页面动起来。

开始每个阶段都有其输入的内容
然后每个阶段都有其处理过程
最后每个阶段都有其输出的内容

### 构建 DOM 树

由于浏览器无法解析直接 HTML，所以把 HTML 转换成————DOM 树。DOM 树就是一种树形结构，树数据结构。
DOM 树经过 HTML 解析器解析，最终输出树状结构的 DOM。DOM 保存在内存种的树状结构，通过 JS 操作可以进行增删改查。

### 样式计算

如果给 DOM 添加或修改样式，就需要经过样式计算。样式计算分为三个步骤完成。

1. 将 CSS 转成浏览器能理解的结构。
   由于浏览器无法直接理解 CSS 的样式，所以当渲染引擎接收到 CSS 文本时，将 CSS 文本转换成浏览器可以理解的结构————styleSheets。
   可以通过`document.styleSheets`在控制台输出其结构。该结构具备了增加和修改。

2. 转换样式表中的属性值，使其标准化。
   例如，一个`<p>`标签上有一个`color:red`，而这个属性上的`red`值，渲染引擎并不会理解，所以要把值转换成渲染引擎容易理解的，标准化的计算值，这个过程叫做属性标准化。
   `red`就会被渲染引擎解析成`rgb(255, 0, 0)`。

3. 计算 DOM 树中每个节点的样式。涉及到两点： CSS 继承规则和层叠规则。
   - CSS 继承就是每个 DOM 节点都包含父节点的样式。比如，一个`body`节点的`font-size`属性是`32px`，那么`body`下的所有子节点的`font-size`都是`32px`。样式计算过程中，
     会根据 DOM 节点的继承关系合理计算节点的样式。
   - CSS 层叠规则是取决于选择器的优先级进行设置样式。

### 布局

布局阶段需要完成两个任务：创建布局和布局计算。

1. 创建布局树只会遍历 DOM 树中可见的元素节点，并将其加到布局树中，而不可见的节点会被忽略掉，例如，`head`中的所有内容和标签上的样式属性中包含`display: none`的都不会被加到布局树中。
