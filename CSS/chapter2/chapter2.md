## 相对单位 em 和 rem

### em 单位

假设，你的页面根元素的字体大小设置为`16px`，那么`1em`就等于`16px`。它会根据继承的字号来进行计算的。

如果知道字号的像素值，但想用`em`单位，可以用一个简单的公式进行换算：用想要的像素大小除以父级（继承）的像素字号。例如，你想要一个`12px`的字体，元素继承的字体是`16px`，
计算的结果为`12/16 = 0.75em`。

### em 相关问题

#### 同时用于字号和其他属性

`em`的复杂之处是同时用它指定一个元素的字号和其他属性。浏览器会先计算字号，然后使用这个计算值去算出其余的属性值。这两类属性可以拥有一个样的单位值，但是计算值不一样。看下面的例子：

```css
body {
  font-size: 16px;
}

.fontSize {
  font-size: 1.2em; /* 计算值为19.2px */
  padding: 1.2em; /* 计算值为 23.04px */
  /* padding的值是用该元素的字体19.2px乘以自身的1.2em 19.2 x 1.2 = 23.04px*/
}
```

#### 字体放大问题

用`em`在多重嵌套的情况下设置元素字号时，会产生意外的结果。看下面的代码。

```html
<div>
  JavaScript
  <div>
    CSS
    <div>HTML</div>
  </div>
</div>
```

```css
body {
  font-size: 14px;
}
div {
  font-size: 1.2em;
}
```

![]("./2-1.jpg")

上面的图展示了字体逐渐变大的效果，为什么会这样呢？这是因为每个`div`都继承了父元素的字体大小，然后进行计算。第一个`div`的计算值为`16.8px`（`14px x 1.2em`），第二个`div`则是用父元素的`16.8px`乘以`1.2em`，依次类推。所以才会导致字体才逐渐变大。

`em`是相对于当前元素的字体大小进行换算的。如果不小心的话，`em`就变得很难驾驭。

### rem 单位

`rem`不是相对于当前元素，而是相对于根元素的单位。不管在页面的什么位置用`rem`，`1.2rem`都是相同的计算值：`1.2`乘以根元素的字号。`rem`是结合了`px`和`em`的优点。

## 视口相对单位

除了`rem`和`em`单位之外，还有相对浏览器视口定义长度的视口的相对单位。

- **vh** : 视口高度的 1/100。
- **vw** : 视口宽度的 1/100。
- **vmin** : 视口宽、高较小的一方的 1/100。
- **vmax** : 视口宽、高较大的一方的 1/100。

假如，浏览器页面设置为`1200px`宽，`800px`高。`1vmin`会选择较小的`8px`（因为高度是`800px`），而`1vmax`会选择较大的`12px`（因为宽度为`1200px`）。

### vw 定义字号

相对视口单位还可以用于设置字号。比如，给一个元素上`font-size: 2vw`，在一个`1200px`的页面上它的计算值为`24px`（`1200`的`2%`）。如果在 IPhone6 上显示，那么它的计算值为`7.5px`（`375`的`2%`）。这样就出现一种情况，就是在 PC 端显示的字体就太大了，在移动端显示就太小了。我们可以使用 CSS 的`calc()`函数。

### calc 函数定义字号

`calc()`函数内可以对两个以上的值进行计算。当你要结合不同单位的值时，`calc()`特别实用。它支持的运算包括**加减乘除**，加减号的两边必须加空格。例如：`calc(1em + 10px)`。

```css
:root {
  font-size: calc(0.5em + 1vw);
}
```

这样就实现了字体会平滑的缩放效果。`0.5em`保证了最小字号，`1vw`则确保了字体会随着视口缩放。当然可以根据自己的爱好去调整这个值。

## 无单位的数值和行高

有一些属性可以用一个不指定单位的数来表示。例如：`line-height`、`z-index`、`font-weight`。任何的长度单位都可以用无单位的值`0`，这种情况下单位不影响计算值，`0px、0%、0em`均相等。

> 一个无单位的 `0`只能用于长度值和百分比，像内边距、边框和宽度等等，不能用于角度值，比如度，或者和时间相关的值，比如秒。

`line-height`属性比较特殊，它的值既可以是有单位的也可以是无单位的。通常应该使用无单位的数值，因为它们的继承方式不同。下面来看个例子。

```css
body {
  line-height: 1.5;
}

.about-us {
  font-size: 2em;
}
```

`body`元素上定义了一个行高，`body`下的所有元素都会被继承。不管你设置了什么字号，这种方式都会按照预期显示。

![]("./2-2-1.jpg")

上面的`div`继承了行高`1.5`。而字号是`32px`（`2em x 16px`，`16px`为浏览器默认字号），那么这个`div`的行高计算值是`48px`（`32px x 1.5`）。每行文字之间都有一个合理的间距。

如果使用有单位的值定义行高，就会产生意想不到的结果。

![]("./2-2-2.jpg")

```css
body {
  line-height: 1.5em;
}

.about-us {
  font-size: 2em;
  width: 150px;
}
```

当一个元素的值定义了有单位的值时，子元素会继承它的计算值。当使用无单位的数值时，继承的是声明值，也就是在每个继承子元素上会重新算它的计算值。

## 自定义属性 (CSS 变量)

要定义一个自定义属性，只要像其他 CSS 属性那样就可以了。

```css
:root {
  --main-color: blue;
}
```

`--main-padding`就是一个变量，其值为`20px`。变量名前面必须得加上`--`符号，这是用来和 CSS 属性做区分，剩下的部分随便命名。变量名必须在一个声明块内声明，上面使用了`:root`（代表`html`标签）选择器，该变量可以在整个网页使用。

```css
:root {
  --main-color: blue;
}

p {
  color: var(--main-color);
}
```

使用变量时，需要用到`var`函数。用`var`函数引用刚才定义的变量`--main-color`应用到你的样式中。

在你的样式中自定义属性定义一个值，在其他地方复用它，这种方式特别适合反复出现的值，比如颜色值，或者定义主题色等等。如果要修改颜色值，直接修改一个地方就可以了。

`var`函数还接收第二个参数，表示备用值。如果第一个参数指定的变量没有定义，就会使用第二个值。

```css
:root {
  --main-color: blue;
}

p {
  /* --other-color没有定义，所以使用了备用值red */
  color: var(--other-color, red);

  /* --main-color定义了，所以使用了这个变量 */
  background: var(--main-color, #fff);
}
```

> 如果`var`函数算出来是一个非法值，对应的属性就会设置成初始值。比如，在`padding: var(--main-color)`中的变量算出来是一个颜色，这种情况下，内边距就为`0`。

### 动态改变自定义属性

自定义属性的样式它的真正意义是，可以层叠和继承：可以在多个选择器中定义相同的变量，这个变量在页面不同地方可以设置不同的值。比如，在一个容器中是黑色，在另外的容器中重新把它定义为白色。看下面的例子

```html
<div class="panel">CSS JavaScript HTML</div>

<div class="dark">
  <div class="panel">前端图图</div>
</div>
```

```css
:root {
  --main-padding: 20px;
  --main-color: blue;
  --main-font: cursive;
}

.panel {
  color: var(--main-color);
}

.dark {
  --main-color: red;
}
```

这里并没有重新定义元素的样式或者给元素加上额外的类，只是在它的父级选择器上重新定义了`--main-color`变量。自定义属性就像作用域变量一样，它的值会被后代元素继承。在`dark`容器中，`--main-color`为红色，在其他容器中则是黑色。

### 用 JS 修改自定义属性

通过 JS 来实现修改自定义属性，可以实现主题切换之类的功能。代码如下。

```js
let rootEle = document.documentElement;
let style = getComputedStyle(rootEle);
let mainColor = style.getPropertyValue("--main-color");
console.log(mainColor); // blue

// 给自定义变量设置一个新的值
rootEle.style.setProperty("--main-color", "#cdf");
```
