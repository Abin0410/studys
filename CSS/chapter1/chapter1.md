## CSS 层叠

层叠是 CSS 的一个基本特征，它是一个定义了如何合并来自多个源的属性值的算法。

当样式发生冲突时，会根据三种规则解决冲突。

1. 样式表的来源：样式是从哪来的，包括你的样式和浏览器默认样式。
2. 选择器优先级：哪些选择器比另一个选择器优先级更高。
3. 源码顺序：样式在 CSS 文件中的顺序。

### 样式表的来源

1. **用户代理样式表**
   网页中的样式并不只是浏览器唯一使用的样式表，还有其他类型或来源的样式表。我们平常写在一个 CSS 文件中的样式属于作者样式表，除此之外还有用户代理样式表，也就是浏览器的默认样式。浏览器默认样式优先级最低。

![]("./1616848907438.jpg")

如果你不喜欢默认样式，可以自己设置其他的值。这种做法就是利用层叠样式来源的规则，你写的样式会覆盖浏览器默认样式，因为来源不同。

2. **!important**声明
   `!important`表示为重要的样式，标记了`!important`的样式会被当作更高优先级的来源。总体的优先级按照从高到底排列。
   - 作者的`!important`
   - 作者
   - 用户代理

### 选择器优先级

如果无法用源解决冲突样式的话，浏览器会检查它们的优先级。

#### 行内样式

在一个标签里加上`style`属性来写样式，就是行内样式。它会覆盖掉所有来自样式表或者`<style>`标签上的样式。如果想覆盖行内样式的话，可以使用`!important`，这样可以把它提升到更高的优先级来源，如果行内样式加上`!important`的话就无法覆盖掉了，如果需要覆盖`style`属性上的样式，最好是在样式表内用`!important`。

#### 选择器优先级

优先级的第二部分由选择器来决定。例如，两个类名选择器比只有一个类名的选择器优先级高。ID 选择器比类名选择器优先级更高，ID 选择器的优先级比拥有任何多个类的选择器都要高。
一样的，类名选择器比标签选择器更高。

优先级的准确规则如下。

- 如果选择器的 ID 数量多，它就更明确。
- 如果 ID 数量一样，那就是拥有最多类的选择器更明确。
- 如果上面两次比较都一致，那就是拥有最多标签名的选择器更明确。

如果你写的样式没有生效，一般情况下是被更高优先级的规则被覆盖了。

> 伪类选择器（`:hover`）和属性选择器（`[type="input"]`）和一个类选择器的优先级相同。通用选择器（`*`）和组合器（`>、+、~`）对优先级没有影响。

#### 优先级标记

比如，用一个数字来表示优先级，那么行内样式为`1000`，ID 选择器为`100`，类名、伪类和属性选择器`10`，标签选择器为`1`。如果优先级相等，可以通过使用`!important`提升到更高的优先级，但是这种做法是最不推荐的。还有可以通过增加或修改选择器来提高优先级，看下面的代码。

```css
/* 优先级为101 */
#content a {
  color: red;
}

/* 优先级最高，但是最不推荐的做法
.featured {
  color: #ccc !important;
}
 */

/* 覆盖掉上面设置的样式 优先级为110 */
#content .featured {
  color: #ccc;
}
```

还有一种是通过不同提升第二个选择器的优先级，而是降低第一个选择器的优先级。

```css
/* 优先级为11 */
.link a {
  color: red;
}

/* 优先级为20 */
.link .featured {
  color: #ccc;
}
```

### 源码顺序

层叠的第三步是源码顺序。如果两个样式的来源和优先级相同，其中一个样式在样式表中出现比较晚，或者在页面比较晚引入的样式表中，那么这个样式就会覆盖前面出现的样式。也就是说，控制代码顺序，给元素添加样式。如果两个冲突选择器的优先级一样，那么出现比较晚的那个就会覆盖之前的。

#### 层叠值

浏览器遵守三个步骤：来源、优先级、源码顺序，进行解析页面上每个元素的每个属性。如果一个样式在层叠中 “胜出”，它就被叫作一个层叠值。元素的每个属性最多只有一个层叠值。
例如，页面上有一个`<p>`标签，它可以有一个上外边距和下外边距，但是不能有两个不同的上外边距或两个不同的下外边距。如果 CSS 给同一个属性指定了不同的值，层叠最终会选出一个值
来渲染元素，这就是层叠值。

### 优先级问题

在处理层叠的时候有两条通用的经验法则。

1. **在选择器中不要使用 ID**：只有一个 ID 也会大幅度提升优先级。如果想要覆盖这个选择器时，通常找不到另外有意义的 ID。于是就会复制原来的选择器，再加上另一个类，让它区别于想覆盖的选择器。

2. **不要使用!important**：它比 ID 更难覆盖，如果用了它，想要覆盖原来的样式，就需要再加上一个`!important`，而且还要处理优先级问题。

## 继承

最后一种给元素添加样式的方式：继承。如果一个元素的某个属性没有层叠值，那么就会继承某个祖先元素的值。例如，`body`元素加上`font-family`，它下面的所有后代元素都会继承这个字体。但是不是所有的属性都会被继承。默认情况下，只有特定的属性能被继承。它们主要是和文本相关的属性。

## 特殊值

有两个特殊值可以赋给任意属性，用来控制层叠：`inherit`和`initial`。

### inherit

有时候，如果想用继承代替一个层叠值。可以用`inherit`。用它来覆盖另一个值，这样该元素就会继承它父元素的值。举个例子。

```html
<div class="text">
  <div class="child-text"></div>
</div>
```

```css
.text {
  padding: 20px;
  background-color: red;
}

.child-text {
  padding: inherit;
  background-color: #fff;
}
```

`text`的内边距设置成了`20px`，而`child-text`就继承了`text`上的`padding`属性值。这样做的好处是，如果修改了父元素的内边距，子元素的内边距也会跟着变。还可以用`inherit`强制继承一个不会被继承的属性。

### initial

有时候，你要撤销某个元素的样式。可以使用`initial`来实现。相当于重置为默认值。
